<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <meta charset="UTF-8">
    <title>ì—¬í–‰ ì¼ì •</title>

    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .submit-button {
            margin-top: 2rem;
            padding: 1rem 2.5rem;
            background-color: #212529;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }

        .submit-button:hover {
            background-color: #000;
        }

        form {
            text-align: center;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <form th:action="@{/schedule/new}" method="post">
        <div id="calendar"></div>

        <input type="hidden" name="selectedCity" th:value="${selectedCity}"/>
        <input type="hidden" name="startDate" id="startDate">
        <input type="hidden" name="endDate" id="endDate">

        <button type="submit" class="submit-button">ì¼ì • ì œì¶œ</button>
    </form>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.getElementById('calendar');
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                selectable: true,

                select: function (info) {
                    if (calendar.selectedRange) {
                        calendar.selectedRange.remove();
                    }

                    if (!calendar.selectedStartDate) {
                        // ì‹œì‘ ë‚ ì§œ ì„ íƒ
                        calendar.selectedStartDate = info.startStr;
                        startDateInput.value = info.startStr;
                        endDateInput.value = '';
                    } else {
                        if (info.startStr < calendar.selectedStartDate) {
                            // ì‹œì‘ ë‚ ì§œë³´ë‹¤ ì•ì„ ë‹¤ì‹œ ì„ íƒí•œ ê²½ìš° -> ìƒˆë¡œ ì§€ì •
                            calendar.selectedStartDate = info.startStr;
                            startDateInput.value = info.startStr;
                            endDateInput.value = '';
                        } else {
                            // ì¢…ë£Œ ë‚ ì§œ ì„ íƒ

                            // ğŸ‘‡ endëŠ” exclusiveì´ë¯€ë¡œ í•˜ë£¨ ë¹¼ì„œ ë³´ì—¬ì¤˜ì•¼ í•¨
                            const endDate = new Date(info.end);
                            endDate.setDate(endDate.getDate());
                            const adjustedEndStr = endDate.toISOString().split('T')[0];

                            calendar.selectedEndDate = adjustedEndStr;
                            endDateInput.value = adjustedEndStr;

                            // ğŸ‘‡ ìº˜ë¦°ë” í‘œì‹œì—ëŠ” info.end ê·¸ëŒ€ë¡œ ì¨ì•¼ 'inclusive'í•˜ê²Œ ë³´ì„
                            calendar.selectedRange = calendar.addEvent({
                                title: 'ì—¬í–‰ ì¼ì •',
                                start: calendar.selectedStartDate,
                                end: info.endStr, // FullCalendarëŠ” exclusiveë¡œ ì²˜ë¦¬
                                rendering: 'background',
                                color: '#adb5bd'
                            });

                            calendar.selectedStartDate = null;
                            calendar.selectedEndDate = null;
                        }
                    }
                }
            });

            calendar.render();
        });
    </script>
</div>
</body>
</html>